function $childNode(o){return window.frames[o]}function animationHover(o,e){o=$(o),o.hover(function(){o.addClass("animated "+e)},function(){window.setTimeout(function(){o.removeClass("animated "+e)},2e3)})}function WinMove(){var o="[class*=col]",e=".ibox-title",i="[class*=col]";$(o).sortable({handle:e,connectWith:i,tolerance:"pointer",forcePlaceholderSize:!0,opacity:.8}).disableSelection()}var $parentNode=window.parent.document;if($(".tooltip-demo").tooltip({selector:"[data-toggle=tooltip]",container:"body"}),$(".modal").appendTo("body"),$("[data-toggle=popover]").popover(),$(".collapse-link").click(function(){var o=$(this).closest("div.ibox"),e=$(this).find("i"),i=o.find("div.ibox-content");i.slideToggle(200),e.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),o.toggleClass("").toggleClass("border-bottom"),setTimeout(function(){o.resize(),o.find("[id^=map-]").resize()},50)}),$(".close-link").click(function(){var o=$(this).closest("div.ibox");o.remove()}),top==this);
var pytitle=$("#pytitle");
parent.$(".layui-layer-title")[0].innerText = $(document).attr("title");
if($("#content").length>0){var $ZZZEditor=new UE.getEditor('content','');$('#contentform').submit(function(){if($ZZZEditor.queryCommandState('source')==1)$ZZZEditor.execCommand('source');});}
if($("#addtime").length>0){jeDate("#addtime",{onClose:false,isinitVal:true,isTime:true,format:"YYYY-MM-DD hh:mm:ss"});}
$("#color").colorpicker().on('changeColor',function(e){$('#title').attr("style","color:"+e.color.toHex());});
$("#select_tag").click(function(){if($("#taglist a").length==0){tagval=$("#tag").val();$.post("function.php?act=gettag",function(result){var json=eval(result);$.each(json,function(i,item){if(tagval.indexOf(json[i].t_name)>=0){$selected="selected";}else{$selected="";}
$("#taglist").append("<a class='btn btn-link addtag "+$selected+"'>"+json[i].t_name+"</a>");});},'json')}});
$("#taglist").on("click",".addtag",function(){tagval=$("#tag").val();tagtext=$(this).text();if($(this).hasClass("selected")){$(this).removeClass("selected");val=tagval.replace(tagtext,"").replace(",,",",");}else{$(this).addClass("selected");val=tagval+","+tagtext;}
if(val.substr(0,1)==',')val=val.substr(1);val=val.replace(/,$/gi,"");$("#tag").val(val);})
function getContentTxt(){$("#pagedesc").val($ZZZEditor.getContentTxt());}
$("#getpinyin").click(function(){$.post("function.php?act=pinyin",{"sort":$("#title").val()},function(result){pytitle.val(result.substring(0,30));pytitle.focus();});});pytitle.blur(function(){var thisval=$(this).val();var oldvalue=$(this).attr("oldvalue");var regular=/^([^\`\+\~\!\#\$\%\^\&\*\(\)\|\}\{\=\"\'\！\￥\……\（\）\——]*[\+\~\!\#\$\%\^\&\*\(\)\|\}\{\=\"\'\`\！\?\:\<\>\•\“\”\；\‘\‘\〈\ 〉\￥\……\（\）\——\｛\｝\【\】\\\/\;\：\？\《\》\。\，\、\[\]\,]+.*)$/;if(thisval==""){$("#addpage").show();}else if(regular.test(thisval)){alert("此网址名称不能含有符号，可以使用-_");pytitle.focus();}});
function getKeys(){var title=$('#title').val().replace(/[&\|\\\,.;，。？！、*^%$#@\-]/g,''),length=title.length,keys='';if(length>4){for(var i=0;i<length;i++){if(i>2&&i%2!=0){keys+=title[i-3]+title[i-2]+title[i-1]+title[i]+'|'}}}else{keys=title};$('#c_pagekey').val(keys);}
function getimgs(file,data){
if (data.state=="SUCCESS"){
		$( '#'+file.id ).find("img").attr("src",data.url);
		$( '#'+file.id ).append("<div class='file-panel'><i class='cancel'>删除</i><i class='moveRight'>向右</i><i class='moveLeft'>向左</i></div>")	
		$( '#'+file.id ).append("<input value="+data.url+" name=picsurl[]>")	
		$( '#'+file.id ).append("<input value="+data.title+" name=picsname[]>")		
		$( '#'+file.id ).find("span").addClass('success')
		if ($("#indexpic").val()==""){
			$("#indexpic").val(data.url);	
			$("#indeximg").attr("src",data.url);	
			$( '#'+file.id ).find("span").addClass('selected')
		}
	}else{
		$( '#'+file.id ).append("<div class='file-panel'><i class='cancel'>删除</i></div>")	
		$( '#'+file.id ).append("<p class='error'>"+data.url+"</p>")	
	}
}
function openimagemanager(folder){layer.open({type: 2, area: ['630px', '450px'], content:"?act=imagelist&upfolder="+folder})}
function openfilemanager(folder){layer.open({type: 2, area: ['780px', '450px'], content:"?act=filelist&upfolder="+folder})}
$("#indexpic").change(function() {   $("#indeximg").attr("src", $(this).val());});
$(function(){
	if($(".chosen-select").length>0){$(".chosen-select").chosen({placeholder_text_multiple:"请选择"});}
	$('textarea').each(function() {
		$value= this.value;
		$height = this.scrollHeight;
		if ($height == 0) {			
		  $height=$value.length >0 ? $value.length : 80;	
		}
		if ($height > 200)  $height=200;
		if ($height < 80) $height=80;
		this.setAttribute('style', 'height:' + ($height) + 'px;');
	}).on('input', function() {
			this.setAttribute('style', 'height:'+this.scrollHeight+'px;overflow-y:hidden;');
	})
	$(".filelist").on('mouseenter',"li",function(){$(this).find(".file-panel").stop().animate({height:30});});
	$(".filelist").on('mouseleave',"li",function(){$(this).find(".file-panel").stop().animate({height:0});});
	$(".filelist").on('click','i',function(){var index=$(this).index();switch(index){
		case 0:$(this).parent().parent("li").remove();return;
		case 1:$(this).parent().parent().before($(this).parent().parent().next());break;
		case 2:$(this).parent().parent().after($(this).parent().parent().prev());break;}
	});
	$(".filelist").on("click", "span", function() {
		$(".filelist").find("span").removeClass("selected")
		$(this).addClass("selected");
		val = $(this).parent().find("input[name='picsurl[]']").val();
		$("#indexpic").val(val);
		$("#indeximg").attr("src", val);　
	});
	$("#file_tbody").on('click', 'i', function() {
		var $class = $(this).attr("class");
		 switch ($class) {
			case 'fa fa-remove':
				$(this).parent().parent("tr").remove();
				 return;
			case 'fa fa-plus':	 
				$(this).parent().html("<i class='fa fa-arrow-up'></i> <i class='fa fa-arrow-down'></i> <i class='fa fa-remove'></i>")
				$("#file_tbody").append("<tr class='fileli'><td></td><td><input name='c_downname[]' class='form-control input-sm' value='' placeholder='附件名称'></td> "
									   +"<td><input name='c_downurl[]' class='form-control input-sm' value='' placeholder='下载地址'></td>"
									   +"<td><i class='fa fa-plus'></i> <i class='fa fa-remove'></i></td></tr>");	
			case 'fa fa-arrow-down':
				$(this).parent().parent().before($(this).parent().parent().next());
				break;
			case 'fa fa-arrow-up':
				$(this).parent().parent().after($(this).parent().parent().prev());
				break;
		}
	});
});
//
$(document).keydown(function(e) {
    if (e.ctrlKey && e.keyCode == 13) {
        if ($("#submit").length > 0) {
            $("#submit").click()
        }
    }
    var keyEvent = false;
    switch (e.keyCode) {
        case 27:
            {
                if ($("#contentform").length > 0) {
                    layer.confirm('确定关闭吗？', function() {
                        parent.layer.closeAll()
                    })
                } else {
                    layer.confirm('确定关闭吗？', function() {
                        $(parent.parent.document.body).find(".J_tabClosethis").click();
                        layer.closeAll();
                        parent.layer.closeAll()
                    })
                }
            }
        case 8:
            {
                var d = e.srcElement || e.target;
                if (d.tagName.toUpperCase() == 'INPUT' || d.tagName.toUpperCase() == 'TEXTAREA') {
                    keyEvent = d.readOnly || d.disabled;
                } else {
                    keyEvent = true;
                }
            }
    }
    if (keyEvent) {
        e.preventDefault();
    }
});

function submitform(table,id,form){
	var check =true;
	if($ZZZEditor){
		if($ZZZEditor.queryCommandState('source')==1) $ZZZEditor.execCommand('source');
	}
	$("#"+form+" .form-control").each(function () {
		$this=$(this);
		var val = $this.val();
		var required = $this.data("required");
		var title = $this.parent().prev('.control-label').text();		
		  if (!checkstr(val, required)) {			
			layer.alert(title + '不符合要求', function(index){				
				$this.focus()	;	
				layer.close(index);
			})				
			check = false;
			return false;
		  }
	  });
	if(check){
		$.post("save.php?act=" + table, $("#" + form).serialize(), function(result) {
			if (result.return_code > 0) {
				if(id==0){
					parent.layer.confirm('添加成功，是否继续添加', function() {
						parent.layer.closeAll('dialog');
						parent.tablerefresh();
						location.href = result.return_url;
					}, function() {
						parent.layer.closeAll();
						parent.tablerefresh();
					});
				}else{
					parent.layer.open({title:'保存成功',content: result.return_msg,icon: 1,time: 3000,end:function(){parent.layer.closeAll();parent.tablerefresh();}});
				}
			}else{
				parent.layer.open({title:'错误提示',content:result.return_msg,icon: 2,time: 3000}); 
			}
		}, 'json')
    }
}

function checkstr(str, type) {
	switch (type) {
		case 'mobile':
			if (str.match(/^1([0-9])\d{9}$/) == null) {
				return false;
			}
			break;
        case 'password':
            if (str.match(/(?![0-9A-Z]+$)(?![0-9a-z]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,18}$/)) {
                return true;
            } else {
                return false;
            }
		case 'tel':
		case 'phone':
			if (str.match(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/) == null) {
				return false;
			}
			break;
		case 'email':
			if (str.match(/[A-Za-z0-9_-]+[@](\S*)(net|com|cn|org|cc|tv|[0-9]{1,3})(\S*)/g) == null) {
				return false;
			}
			break;
		case 'domain':
			if (str.match(/[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})/g) == null) {
				return false;
			}
			break;
		case 'num':
			var regPos = /^\d+(\.\d+)?$/; //非负浮点数
			var regNeg = /^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/; //负浮点数
				if(regPos.test(str) || regNeg.test(str)){
					return true;
				}else{
					return false;
				}
			break;
		case 'nul':
		case '*':
		case 'date':	
			if (typeof str == undefined || str == null || str == ""  || str == "undefined"   || str == "请选择") {
				return false;
			}
			break;		
	}
	return true;
}    